{% extends 'base.html.twig' %}

{% block title %}Espace Encadrant{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <style>
    .card:hover {
    background-color: #4487da; /* fond bleu */
    color: white; /* texte général en blanc */
}

/* Spécifiquement pour le contenu du message */
.card:hover .message-content {
    color: white;
    background-color: rgba(0, 0, 0, 0.2); /* rend le fond plus foncé et donc le texte plus lisible */
}
.card:hover .message-content {
    mix-blend-mode: lighten;
}

        /* Styles pour les cartes */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .card-title {
            margin: 0;
            font-size: 1.2rem;
            color: #333;
        }

        /* Styles spécifiques pour la messagerie */
        .message-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .message-content {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .reply-box {
            flex-grow: 1;
            min-height: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            font-family: inherit;
        }

        /* Styles pour les onglets (version simplifiée) */
        .tab-btn.active {
            color: #4487da;
            background-color: transparent;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .message-tabs {
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
    </style>
{% endblock %}

{% block body %}
<div class="stagiaire-interface">
    <!-- Sidebar -->
    <aside class="stagiaire-sidebar">
        <div class="sidebar-header">
            <i class="bi bi-journal-bookmark"></i>
            <h2>StageConnect</h2>
        </div>
        <div class="profile-section">
            <div class="profile-pic">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="profile-info">
                <span class="username"><b>Bienvenue {{encad.prenom}} {{encad.nom}}</b></span>
                <span class="role">Encadrant</span>
            </div>
        </div>
        <nav class="stagiaire-nav">
            <div class="sidebar-account">
                <h3><i class="bi bi-gear"></i> Mon compte</h3>
                <ul>
                    <li>
                        <a href="{{path('app_changepassword')}}">
                            <i class="bi bi-key"></i> Changer mot de passe
                        </a>
                    </li>
                    <li>
                        <form action="{{ path('app_logout') }}" method="post">
                            <button type="submit" class="logout-btn">
                                <i class="bi bi-box-arrow-right"></i> Déconnexion
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="stagiaire-main">
        <!-- Onglets Messagerie -->
        
<div class="message-tabs">
    {% for stagiaire in stagiaires %}
        <button class="tab-btn {% if loop.first %}active{% endif %}" data-target="stagiaire-{{ stagiaire.id }}">
            <i class="bi bi-person-fill"></i> {{ stagiaire.prenom }} {{ stagiaire.nom }}
        </button>
    {% endfor %}
</div>

<div class="tab-content">
    {% for stagiaire in stagiaires %}
        <div id="stagiaire-{{ stagiaire.id }}" class="tab-pane {% if loop.first %}active{% endif %}">
            <!-- Messages du stagiaire -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Message</h3>
                    </div>
                    <div class="message-container">
                     {% for message in  messages_par_stagiaire[stagiaire.id] %}

                        <div class="message-header">
                            <span class="sender">{{ message.expediteur.prenom }} {{ message.expediteur.nom }}</span>
                            <span class="time">{{ message.dateEnvoi|date('d/m/Y H:i') }}</span>
                        </div>
                        <div class="message-content">{{ message.contenu }}</div>
                        {% else %}
                                        <p>Aucun message.</p>
                                         {% endfor %}
<form action="{{ path('app_envoyer_message_encad', {'idStagiaire': stagiaire.id}) }}" method="post">
    <textarea name="contenu" class="reply-box" placeholder="Votre réponse..." required></textarea>
    <div class="text-end mt-2">
        <button class="btn btn-sm btn-primary" type="submit">Envoyer</button>
    </div>
</form>
                    </div>
                </div>
            
           
            

            <!-- Fichiers uploadés -->
            <div class="card">
    <div class="card-header">
        <h3 class="card-title"><i class="bi bi-clock-history"></i> Historique des fichiers reçus</h3>
    </div>
    <div class="file-list">
        {% for fichier in partages %}
            <p>
                <i class="bi bi-file-earmark-text"></i>
                <a href="{{ asset('uploads/' ~ fichier.lien) }}" target="_blank">{{ fichier.titre }}</a>
                <br><small>Reçu de {{ fichier.ajouteePar.prenom }} {{ fichier.ajouteePar.nom }} le {{ fichier.dateAjout|date('d/m/Y H:i') }}</small>
            </p>
        {% else %}
            <p>Aucun fichier reçu.</p>
        {% endfor %}
    </div>
</div>

        </div>
    {% endfor %}
</div>

        
        

            

                
            </div>
        </div>
    </main>
</div>
{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const tabButtons = document.querySelectorAll(".tab-btn");
            const tabPanes = document.querySelectorAll(".tab-pane");

            if (tabButtons.length === 0 || tabPanes.length === 0) {
                console.warn("Onglets non trouvés !");
                return;
            }
            tabButtons.forEach(btn => {
                btn.addEventListener("click", function () {
                    tabButtons.forEach(b => b.classList.remove("active"));
                    tabPanes.forEach(pane => pane.classList.remove("active"));
                    this.classList.add("active");
                    const targetId = this.dataset.target;
                    const target = document.getElementById(targetId);
                    if (target) target.classList.add("active");
                });
            });
        });
    </script>
{% endblock %}
{% endblock %}